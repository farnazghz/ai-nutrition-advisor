<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ü•ó AI Nutrition Advisor</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&family=Playfair+Display:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #8b5cf6;
            --primary-light: #c4b5fd;
            --primary-dark: #7c3aed;
            --secondary: #f8fafc;
            --accent: #06b6d4;
            --accent-light: #a7f3d0;
            --accent-orange: #f59e0b;
            --accent-orange-light: #fde68a;
            --sage-green: #10b981;
            --soft-blue: #dbeafe;
            --mint: #d1fae5;
            --peach: #fed7d7;
            --text-primary: #1e293b;
            --text-secondary: #64748b;
            --text-muted: #94a3b8;
            --neutral-50: #f9fafb;
            --neutral-100: #f3f4f6;
            --neutral-200: #e5e7eb;
            --neutral-300: #d1d5db;
            --neutral-400: #9ca3af;
            --neutral-500: #6b7280;
            --neutral-600: #4b5563;
            --neutral-700: #374151;
            --neutral-800: #1f2937;
            --neutral-900: #111827;
            --background: linear-gradient(135deg, #fef7ff 0%, #f0f9ff 50%, #ecfdf5 100%);
            --card-bg: rgba(255, 255, 255, 0.8);
            --glass-bg: rgba(255, 255, 255, 0.25);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Poppins', -apple-system, BlinkMacSystemFont, sans-serif;
            line-height: 1.6;
            background: var(--background);
            background-attachment: fixed;
            min-height: 100vh;
            color: var(--text-primary);
            margin: 0;
            padding: 0;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 20px;
        }

        /* Banner Hero Section */
        .hero-header {
            background: url('channels4_banner.jpg') center center/cover;
            position: relative;
            overflow: hidden;
            padding: 120px 0 100px 0;
            color: white;
            text-align: center;
        }

        .hero-header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, rgba(0, 0, 0, 0.3) 0%, rgba(0, 0, 0, 0.2) 100%);
        }

        .hero-content {
            position: relative;
            z-index: 2;
            text-align: center;
        }

        .hero-title {
            font-family: 'Playfair Display', serif;
            font-size: 4rem;
            font-weight: 700;
            margin-bottom: 1.5rem;
            letter-spacing: -0.01em;
            line-height: 1.2;
            text-shadow: 0 4px 20px rgba(0,0,0,0.5), 0 2px 10px rgba(0,0,0,0.3);
        }

        .hero-subtitle {
            font-size: 1.2rem;
            font-weight: 400;
            opacity: 0.95;
            max-width: 600px;
            margin: 0 auto;
            text-shadow: 0 2px 10px rgba(0,0,0,0.4);
            line-height: 1.5;
        }

        /* Soft Navigation Tabs */
        .nav-tabs {
            display: flex;
            justify-content: center;
            gap: 8px;
            margin: -40px auto 60px auto;
            max-width: 650px;
            background: var(--glass-bg);
            border-radius: 20px;
            padding: 8px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.08);
            backdrop-filter: blur(20px);
            position: relative;
            z-index: 4;
            border: 1px solid rgba(255,255,255,0.3);
        }

        .nav-tab {
            flex: 1;
            padding: 14px 24px;
            background: transparent;
            border: none;
            border-radius: 16px;
            cursor: pointer;
            font-size: 0.95rem;
            font-weight: 500;
            color: var(--text-secondary);
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0;
            letter-spacing: 0.5px;
            text-transform: none;
        }

        .nav-tab.active {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
            font-weight: 600;
            box-shadow: 0 4px 15px rgba(139, 92, 246, 0.3);
            transform: translateY(-1px);
        }


        /* Page Content */
        .page-content {
            display: none;
        }

        .page-content.active {
            display: block;
        }

        /* Simple Ingredient Categories */
        .ingredient-categories {
            display: flex;
            justify-content: center;
            gap: 4px;
            margin: 30px auto;
            max-width: 600px;
            background: white;
            border-radius: 12px;
            padding: 6px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }

        .category-btn {
            flex: 1;
            padding: 12px 20px;
            background: transparent;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.95rem;
            font-weight: 500;
            color: var(--text-secondary);
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            letter-spacing: 0.3px;
        }

        .category-btn.active {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
            font-weight: 600;
            box-shadow: 0 4px 15px rgba(139, 92, 246, 0.4);
            transform: translateY(-1px);
        }

        /* Force no hover effects on category buttons */
        .category-btn:hover {
            background: transparent !important;
            color: var(--text-secondary) !important;
            transform: none !important;
            box-shadow: none !important;
        }

        .category-btn.active:hover {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%) !important;
            color: white !important;
            font-weight: 600 !important;
            box-shadow: 0 4px 15px rgba(139, 92, 246, 0.4) !important;
            transform: translateY(-1px) !important;
        }


        .food-icons {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 30px;
        }

        .food-icon {
            font-size: 2rem;
            background: rgba(255,255,255,0.2);
            padding: 15px;
            border-radius: 50%;
            backdrop-filter: blur(10px);
            transition: transform 0.3s ease;
        }


        /* Channel Info Card */
        .channel-card {
            background: white;
            border-radius: 20px;
            padding: 30px;
            margin: -40px auto 40px auto;
            max-width: 800px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            position: relative;
            z-index: 3;
            display: flex;
            align-items: center;
            gap: 25px;
        }

        .channel-avatar {
            width: 100px;
            height: 100px;
            border-radius: 20px;
            border: 4px solid var(--primary-green-light);
            object-fit: cover;
        }

        .channel-info h3 {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--neutral-800);
            margin-bottom: 8px;
        }

        .channel-stats {
            display: flex;
            gap: 20px;
            margin-top: 15px;
        }

        .stat-item {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 0.9rem;
            color: var(--neutral-600);
            background: var(--neutral-100);
            padding: 6px 12px;
            border-radius: 8px;
        }

        /* Soft Question Section */
        .question-section {
            background: var(--card-bg);
            border-radius: 20px;
            padding: 40px;
            margin-bottom: 40px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.08);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255,255,255,0.3);
        }

        .section-title {
            font-family: 'Poppins', sans-serif;
            font-size: 1.8rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 12px;
            letter-spacing: -0.01em;
        }

        .section-description {
            color: var(--neutral-600);
            margin-bottom: 30px;
            font-size: 1.1rem;
        }

        .question-input {
            width: 100%;
            padding: 20px;
            border: 2px solid rgba(168, 162, 158, 0.15);
            border-radius: 16px;
            font-size: 16px;
            font-family: inherit;
            margin-bottom: 24px;
            resize: vertical;
            min-height: 120px;
            transition: all 0.3s ease;
            background: rgba(255,255,255,0.7);
            backdrop-filter: blur(10px);
        }

        .question-input:focus {
            border-color: var(--olive-green);
            outline: none;
            box-shadow: 0 0 0 3px rgba(132, 169, 140, 0.2);
        }

        .button-group {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }

        .btn {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
            border: none;
            padding: 14px 28px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 500;
            font-family: inherit;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            text-transform: none;
            letter-spacing: 0.5px;
            box-shadow: 0 4px 15px rgba(139, 92, 246, 0.2);
        }


        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .btn-secondary {
            background: linear-gradient(135deg, var(--text-secondary) 0%, var(--text-muted) 100%);
        }


        /* Answer Section */
        .answer-section {
            background: var(--neutral-50);
            border-radius: 16px;
            padding: 30px;
            margin-top: 30px;
            display: none;
            border: 1px solid var(--neutral-200);
        }

        .answer-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 20px;
        }

        .answer-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--neutral-800);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .voice-btn {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white !important;
            border: none;
            padding: 10px 18px;
            border-radius: 12px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(139, 92, 246, 0.3);
        }


        .answer-content {
            background: white;
            padding: 24px;
            border-radius: 12px;
            margin-bottom: 20px;
            border-left: 4px solid var(--primary-green);
            font-size: 1.05rem;
            line-height: 1.7;
        }


        /* Simple Videos Grid */
        .videos-section {
            background: white;
            border-radius: 12px;
            padding: 32px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
        }

        .videos-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 25px;
            margin-top: 30px;
        }

        .video-card {
            background: white;
            border-radius: 12px;
            padding: 0;
            border: 1px solid #e2e8f0;
            transition: all 0.3s ease;
            cursor: pointer;
            position: relative;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }

        .video-thumbnail {
            width: 100%;
            height: 180px;
            background: linear-gradient(135deg, var(--olive-light) 0%, var(--olive-green) 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.5rem;
            border-radius: 12px 12px 0 0;
            position: relative;
            overflow: hidden;
        }

        .video-content {
            padding: 20px;
            flex: 1;
        }

        .video-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--primary-green), var(--accent-orange));
            transform: scaleX(0);
            transition: transform 0.3s ease;
        }



        .video-title {
            font-size: 1.25rem;
            font-weight: 700;
            margin-bottom: 8px;
            color: var(--neutral-800);
            line-height: 1.3;
        }

        .video-date {
            font-size: 0.9rem;
            color: var(--neutral-500);
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .video-summary {
            color: var(--neutral-700);
            font-size: 1rem;
            line-height: 1.5;
            background: var(--neutral-50);
            padding: 16px;
            border-radius: 12px;
            border-left: 4px solid var(--accent-orange);
            margin-top: 12px;
        }

        .video-summary-title {
            font-weight: 600;
            color: var(--accent-orange);
            margin-bottom: 8px;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        /* Modal */
        .video-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            z-index: 1000;
            overflow-y: auto;
            backdrop-filter: blur(5px);
        }

        .modal-content {
            background: white;
            margin: 40px auto;
            padding: 40px;
            border-radius: 24px;
            max-width: 900px;
            position: relative;
            box-shadow: 0 25px 50px rgba(0,0,0,0.2);
        }

        .modal-close {
            position: absolute;
            top: 20px;
            right: 24px;
            background: var(--neutral-100);
            border: none;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            color: var(--neutral-600);
            transition: all 0.3s ease;
        }


        .modal-title {
            font-size: 1.75rem;
            font-weight: 600;
            margin-bottom: 20px;
            padding-right: 50px;
            color: var(--neutral-800);
        }

        .modal-meta {
            display: flex;
            gap: 20px;
            margin-bottom: 30px;
            padding: 16px;
            background: var(--neutral-50);
            border-radius: 12px;
        }

        .summary-section {
            margin-bottom: 30px;
        }

        .summary-header {
            display: flex;
            align-items: center;
            justify-content: between;
            margin-bottom: 15px;
        }

        .summary-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--neutral-800);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid var(--neutral-200);
            border-top: 3px solid var(--primary-green);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .error {
            background: #fef2f2;
            color: #dc2626;
            padding: 16px;
            border-radius: 12px;
            border-left: 4px solid #dc2626;
            margin-top: 20px;
        }

        .success {
            background: #f0fdf4;
            color: #16a34a;
            padding: 16px;
            border-radius: 12px;
            border-left: 4px solid #16a34a;
            margin-top: 20px;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .container {
                padding: 0 15px;
            }
            
            .hero-title {
                font-size: 2.5rem;
            }
            
            .channel-card {
                flex-direction: column;
                text-align: center;
                margin: -20px auto 30px auto;
            }
            
            .channel-stats {
                justify-content: center;
            }
            
            .videos-grid {
                grid-template-columns: 1fr;
            }
            
            .button-group {
                flex-direction: column;
            }
        }

        /* Ingredient Guide Styles */
        .ingredient-categories {
            display: flex;
            gap: 12px;
            margin: 30px 0;
            flex-wrap: wrap;
        }

        .category-btn {
            padding: 12px 24px;
            border: 2px solid var(--neutral-200);
            background: white;
            border-radius: 25px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .category-btn:hover {
            border-color: var(--primary);
            transform: translateY(-2px);
        }

        .category-btn.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        .ingredient-card {
            background: var(--card-bg);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            padding: 24px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: all 0.3s ease;
            text-align: center;
        }

        .ingredient-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }

        .ingredient-icon {
            font-size: 3rem;
            margin-bottom: 16px;
        }

        .ingredient-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--neutral-800);
            margin-bottom: 12px;
        }

        .ingredient-description {
            color: var(--neutral-600);
            line-height: 1.6;
            margin-bottom: 16px;
        }

        .ingredient-dosage {
            background: var(--neutral-50);
            color: var(--neutral-700);
            padding: 8px 12px;
            border-radius: 8px;
            font-size: 0.9rem;
            margin-bottom: 16px;
        }

        .ingredient-benefits {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .benefit-tag {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 500;
        }

        .benefit-tag.benefit {
            background: var(--mint);
            color: var(--sage-green);
        }

        .benefit-tag.problem {
            background: var(--peach);
            color: #dc2626;
        }
    </style>
</head>
<body>
    <!-- Demo Banner -->
    <div style="background: linear-gradient(135deg, #3b82f6, #8b5cf6); color: white; text-align: center; padding: 12px; font-weight: 500; font-size: 14px; position: relative; z-index: 1000;">
        üöÄ <strong>DEMO VERSION</strong> - This is a fully functional demo using mock data. Try the Q&A and video sync features! 
        <span style="opacity: 0.8; margin-left: 10px;">All responses are AI-generated for demonstration purposes.</span>
    </div>
    
    <div class="hero-header">
        <div class="container">
            <div class="hero-content">
                <h1 class="hero-title">AI Nutrition Advisor</h1>
                <p class="hero-subtitle">Get personalized health answers based on Dr Berg opinion</p>
            </div>
        </div>
    </div>

    <div class="container">

        <!-- Navigation Tabs -->
        <div class="nav-tabs">
            <button class="nav-tab active" onclick="switchTab('qa')">
                Ask Questions
            </button>
            <button class="nav-tab" onclick="switchTab('videos')">
                Recent Videos
            </button>
            <button class="nav-tab" onclick="switchTab('ingredients')">
                Nutrition Guide
            </button>
        </div>

        <!-- Q&A Page -->
        <div id="qa-page" class="page-content active">
            <div class="question-section">
                <h2 class="section-title">
                    Ask Your Question
                </h2>
                <p class="section-description">
                    Ask any question about nutrition, diet, or supplements and get expert advice based on Dr. Berg's videos and recommendations
                </p>
            
            <textarea 
                id="questionInput" 
                class="question-input" 
                placeholder="e.g., What are the best foods for ketosis? How much vitamin D should I take daily?"
            ></textarea>
            
            <div class="button-group">
                <button id="askButton" class="btn">
                    <span>üîç</span>
                    Ask Question
                </button>
            </div>
            
            <div id="answerSection" class="answer-section">
                <div class="answer-header">
                    <h3 class="answer-title">
                        <img id="drBergAnswerAvatar" src="https://yt3.ggpht.com/ytc/AIdro_m6Tb12iR0Ej4n1T1gvBIu3ovkOYWdZxR09O2gar8b7Ta0=s240-c-k-c0x00ffffff-no-rj" alt="Dr. Berg" style="width: 40px; height: 40px; border-radius: 50%; margin-right: 12px;" />
                        Dr. Berg's Answer
                    </h3>
                </div>
                <div id="answerText" class="answer-content"></div>
                
                <div id="relevantVideos" style="margin-top: 20px;"></div>
            </div>
            
                <div id="messageArea"></div>
            </div>
        </div>

        <!-- Recent Videos Page -->
        <div id="videos-page" class="page-content">
            <div class="videos-section">
                <h2 class="section-title">
                    <span>üìπ</span>
                    Recent Videos
                </h2>
                <div id="videosGrid" class="videos-grid">
                    <p>Loading videos...</p>
                </div>
            </div>
        </div>

        <!-- Ingredients Page -->
        <div id="ingredients-page" class="page-content">
            <div class="videos-section">
                <h2 class="section-title">
                    <span>üß™</span>
                    Food & Nutrition Guide
                </h2>
                <p class="section-description">
                    Discover what Dr. Berg says about foods, vitamins, and ingredients
                </p>
                
                <!-- Category Selection -->
                <div class="ingredient-categories">
                    <button class="category-btn active" onclick="switchIngredientCategory('good')">
                        <span>‚úÖ</span>
                        Good Foods
                    </button>
                    <button class="category-btn" onclick="switchIngredientCategory('bad')">
                        <span>‚ùå</span>
                        Bad Foods
                    </button>
                    <button class="category-btn" onclick="switchIngredientCategory('vitamins')">
                        <span>üíä</span>
                        Vitamins
                    </button>
                </div>

                <div id="ingredientsGrid" class="videos-grid">
                    <p>Loading nutrition guide...</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Video Detail Modal -->
    <div id="videoModal" class="video-modal">
        <div class="modal-content">
            <button class="modal-close" onclick="closeVideoDetail()">√ó</button>
            <h2 id="modalTitle" class="modal-title">Video Title</h2>
            <div id="modalMeta" class="modal-meta"></div>
            
            <div class="summary-section">
                <div class="summary-header">
                    <h3 class="summary-title">
                        <span>üìù</span>
                        English Summary
                    </h3>
                    <button class="voice-btn" onclick="readText('modalSummary')">
                        <span>üîä</span>
                        Read
                    </button>
                </div>
                <div id="modalSummary" class="answer-content"></div>
            </div>

            
            <a id="modalWatchLink" href="#" target="_blank" class="btn" style="margin-top: 20px;">
                <span>üé•</span>
                Watch on YouTube
            </a>
        </div>
    </div>

    <script>
        class NutritionAdvisor {
            constructor() {
                this.init();
            }

            async init() {
                this.bindEvents();
                await this.loadChannelInfo();
                await this.loadVideos();
            }

            bindEvents() {
                document.getElementById('askButton').addEventListener('click', () => this.askQuestion());
                
                document.getElementById('questionInput').addEventListener('keypress', (e) => {
                    if (e.key === 'Enter' && e.ctrlKey) {
                        this.askQuestion();
                    }
                });
            }

            async loadChannelInfo() {
                try {
                    // Mock channel info for demo
                    const channelInfo = {
                        title: 'AI Nutrition Expert (Demo)',
                        thumbnail: 'https://images.unsplash.com/photo-1559839734-2b71ea197ec2?w=150&h=150&fit=crop&crop=face',
                        videoCount: 2847,
                        subscriberCount: 3200000,
                        viewCount: 892000000,
                        description: 'Providing evidence-based nutrition information, practical health tips, and scientific insights to help you achieve optimal wellness through proper nutrition and lifestyle choices.'
                    };
                    
                    document.getElementById('channelTitle').textContent = channelInfo.title;
                    document.getElementById('channelAvatar').src = channelInfo.thumbnail;
                    document.getElementById('channelVideoCount').textContent = this.formatNumber(channelInfo.videoCount);
                    document.getElementById('channelSubCount').textContent = this.formatNumber(channelInfo.subscriberCount);
                    document.getElementById('channelViewCount').textContent = this.formatNumber(channelInfo.viewCount);
                    
                    // Set avatar in answer section
                    const answerAvatar = document.getElementById('drBergAnswerAvatar');
                    if (answerAvatar) {
                        answerAvatar.src = channelInfo.thumbnail;
                        console.log('‚úÖ Avatar set for answers:', channelInfo.thumbnail);
                    }
                    
                    const description = channelInfo.description;
                    const shortDescription = description.length > 150 ? description.substring(0, 150) + '...' : description;
                    document.getElementById('channelDescription').textContent = shortDescription;
                    
                    document.getElementById('channelCard').style.display = 'flex';
                    
                } catch (error) {
                    console.error('Error loading channel info:', error);
                }
            }

            formatNumber(num) {
                if (num >= 1000000) {
                    return (num / 1000000).toFixed(1) + 'M';
                }
                if (num >= 1000) {
                    return (num / 1000).toFixed(1) + 'K';
                }
                return num.toString();
            }

            async loadVideos() {
                try {
                    // Mock video data for demo
                    const videos = window.currentVideos || [];
                    
                    const videosGrid = document.getElementById('videosGrid');
                    
                    if (videos.length === 0) {
                        videosGrid.innerHTML = '<p style="text-align: center; color: var(--neutral-600);">No videos processed yet. Click "Sync Recent Videos" to get started.</p>';
                        return;
                    }

                    videosGrid.innerHTML = videos.map(video => `
                        <div class="video-card" onclick="showVideoDetail('${video.video_id}')">
                            <div class="video-content">
                                <h3 class="video-title">${video.title}</h3>
                                <div class="video-date">
                                    <span>üìÖ</span>
                                    ${new Date(video.published_at).toLocaleDateString()}
                                </div>
                            </div>
                        </div>
                    `).join('');
                    
                } catch (error) {
                    console.error('Error loading videos:', error);
                    document.getElementById('videosGrid').innerHTML = '<p style="color: var(--accent-orange);">Error loading videos</p>';
                }
            }

            async askQuestion() {
                const questionInput = document.getElementById('questionInput');
                const askButton = document.getElementById('askButton');
                const answerSection = document.getElementById('answerSection');
                const answerText = document.getElementById('answerText');
                const relevantVideos = document.getElementById('relevantVideos');
                const messageArea = document.getElementById('messageArea');

                const question = questionInput.value.trim();
                if (!question) {
                    this.showMessage('error', 'Please enter a question');
                    return;
                }

                askButton.disabled = true;
                askButton.innerHTML = '<span class="loading"></span>Processing...';
                answerSection.style.display = 'none';
                messageArea.innerHTML = '';

                // Simulate processing delay
                await new Promise(resolve => setTimeout(resolve, 1500));

                try {
                    // Mock AI responses based on question keywords
                    const mockAnswer = this.generateMockAnswer(question);
                    
                    answerText.innerHTML = mockAnswer.replace(/\n/g, '<br>');
                    relevantVideos.innerHTML = '';
                    answerSection.style.display = 'block';

                } catch (error) {
                    console.error('Error asking question:', error);
                    this.showMessage('error', error.message);
                } finally {
                    askButton.disabled = false;
                    askButton.innerHTML = '<span>üîç</span>Ask Question';
                }
            }

            generateMockAnswer(question) {
                const q = question.toLowerCase();
                
                if (q.includes('keto') || q.includes('ketogenic')) {
                    return "Based on extensive nutrition research, the ketogenic diet can be highly effective for weight loss and metabolic health. Key principles include:\n\n‚Ä¢ Keep carbs under 20-50g daily\n‚Ä¢ Focus on healthy fats (70-80% of calories)\n‚Ä¢ Moderate protein intake (15-25%)\n‚Ä¢ Stay hydrated and replenish electrolytes\n\nImportant: Always consult with a healthcare provider before starting any new diet, especially if you have medical conditions.";
                } else if (q.includes('vitamin') || q.includes('supplement')) {
                    return "Vitamin supplementation should be based on individual needs and deficiencies. Common considerations:\n\n‚Ä¢ Vitamin D3: Essential for most people, especially in winter\n‚Ä¢ B-Complex: Important for energy and nervous system\n‚Ä¢ Magnesium: Often deficient, crucial for 300+ enzymatic reactions\n‚Ä¢ Omega-3: Anti-inflammatory, supports brain and heart health\n\nBest approach: Get blood work done to identify specific deficiencies, then supplement accordingly with high-quality products.";
                } else if (q.includes('weight') || q.includes('lose') || q.includes('fat')) {
                    return "Sustainable weight loss focuses on metabolic health rather than just calories:\n\n‚Ä¢ Prioritize whole, unprocessed foods\n‚Ä¢ Combine intermittent fasting with proper nutrition\n‚Ä¢ Include strength training to preserve muscle mass\n‚Ä¢ Manage stress and get quality sleep\n‚Ä¢ Stay consistent with small, sustainable changes\n\nRemember: Rapid weight loss often leads to muscle loss and metabolic slowdown. Aim for 1-2 pounds per week for lasting results.";
                } else if (q.includes('sugar') || q.includes('carb') || q.includes('diabetes')) {
                    return "Managing blood sugar is crucial for overall health:\n\n‚Ä¢ Avoid refined sugars and processed carbohydrates\n‚Ä¢ Choose complex carbs with fiber when eating carbs\n‚Ä¢ Combine carbs with protein and healthy fats\n‚Ä¢ Consider intermittent fasting to improve insulin sensitivity\n‚Ä¢ Regular exercise helps with glucose uptake\n\nFor diabetics: Work closely with your healthcare team to monitor blood sugar and adjust medications as needed.";
                } else if (q.includes('intermittent') || q.includes('fasting')) {
                    return "Intermittent fasting can offer numerous health benefits when done properly:\n\n‚Ä¢ Start with 16:8 (16 hours fasting, 8 hours eating)\n‚Ä¢ Stay hydrated during fasting periods\n‚Ä¢ Break fasts with nutrient-dense foods\n‚Ä¢ Listen to your body and adjust as needed\n‚Ä¢ Benefits may include improved insulin sensitivity, autophagy, and mental clarity\n\nNote: Pregnant women, children, and those with eating disorders should avoid fasting.";
                } else {
                    return `Great question about "${question}"! Based on nutritional science principles:\n\n‚Ä¢ Focus on whole, unprocessed foods as your foundation\n‚Ä¢ Maintain proper hydration throughout the day\n‚Ä¢ Include a variety of micronutrients from diverse food sources\n‚Ä¢ Consider your individual metabolic needs and health goals\n‚Ä¢ Consistency with healthy habits trumps perfection\n\nThis is a demo response. For personalized nutrition advice, please consult with a qualified healthcare professional or registered dietitian.`;
                }
            }

            async syncVideos() {
                const button = document.getElementById('syncVideosBtn');
                const messageArea = document.getElementById('messageArea');

                button.disabled = true;
                button.innerHTML = '<span class="loading"></span>Syncing...';
                messageArea.innerHTML = '';

                // Simulate sync delay
                await new Promise(resolve => setTimeout(resolve, 2000));

                try {
                    // Mock video data
                    const mockVideos = [
                        {
                            video_id: 'keto123',
                            title: 'The Complete Guide to Ketogenic Diet Success',
                            description: 'Learn the science-backed approach to ketosis and metabolic flexibility.',
                            published_at: '2024-06-15T10:00:00Z',
                            duration: 'PT15M30S',
                            view_count: 125000,
                            like_count: 8500,
                            summary: 'This comprehensive guide covers the fundamental principles of ketogenic nutrition, including macronutrient ratios, common mistakes, and practical implementation strategies for sustainable results.',
                            stored_tokens: 12
                        },
                        {
                            video_id: 'vitamin456',
                            title: 'Essential Vitamins You Need Daily',
                            description: 'Discover which vitamins are crucial for optimal health and how to get them.',
                            published_at: '2024-06-10T14:30:00Z',
                            duration: 'PT12M45S',
                            view_count: 89000,
                            like_count: 6200,
                            summary: 'An in-depth analysis of essential vitamins including D3, B-complex, magnesium, and omega-3 fatty acids. Covers deficiency symptoms, food sources, and supplementation guidelines.',
                            stored_tokens: 8
                        },
                        {
                            video_id: 'fasting789',
                            title: 'Intermittent Fasting: Science and Practice',
                            description: 'The complete guide to intermittent fasting protocols and their health benefits.',
                            published_at: '2024-06-05T09:15:00Z',
                            duration: 'PT18M20S',
                            view_count: 156000,
                            like_count: 11200,
                            summary: 'Explores various intermittent fasting protocols including 16:8, OMAD, and extended fasting. Discusses autophagy, insulin sensitivity, and practical implementation tips.',
                            stored_tokens: 15
                        },
                        {
                            video_id: 'sugar999',
                            title: 'Hidden Sugars Destroying Your Health',
                            description: 'Learn to identify and avoid hidden sugars in processed foods.',
                            published_at: '2024-05-28T16:45:00Z',
                            duration: 'PT10M15S',
                            view_count: 203000,
                            like_count: 14800,
                            summary: 'Reveals the hidden sources of sugar in common foods and their impact on metabolism, insulin resistance, and inflammation. Provides practical strategies for reducing sugar intake.',
                            stored_tokens: 6
                        },
                        {
                            video_id: 'electro111',
                            title: 'Electrolyte Balance for Optimal Health',
                            description: 'Understanding sodium, potassium, and magnesium for peak performance.',
                            published_at: '2024-05-20T11:30:00Z',
                            duration: 'PT14M50S',
                            view_count: 78000,
                            like_count: 5400,
                            summary: 'Comprehensive guide to electrolyte balance, covering the roles of sodium, potassium, magnesium, and calcium in cellular function, hydration, and energy production.',
                            stored_tokens: 10
                        }
                    ];

                    // Store mock videos globally
                    window.currentVideos = mockVideos;

                    this.showMessage('success', `Successfully synced ${mockVideos.length} additional videos with AI-powered summaries`);
                    await this.loadVideos();

                } catch (error) {
                    console.error('Error syncing videos:', error);
                    this.showMessage('error', error.message);
                } finally {
                    button.disabled = false;
                    button.innerHTML = '<span>üì•</span>Sync Recent Videos';
                }
            }

            showMessage(type, message) {
                const messageArea = document.getElementById('messageArea');
                messageArea.innerHTML = `<div class="${type}">${message}</div>`;
                setTimeout(() => {
                    messageArea.innerHTML = '';
                }, 5000);
            }

            getTopicIcon(title) {
                const titleLower = title.toLowerCase();
                if (titleLower.includes('vitamin') || titleLower.includes('supplement')) return 'üíä';
                if (titleLower.includes('keto') || titleLower.includes('fat')) return 'ü•ë';
                if (titleLower.includes('sugar') || titleLower.includes('carb')) return 'üçØ';
                if (titleLower.includes('protein') || titleLower.includes('meat')) return 'ü•©';
                if (titleLower.includes('vegetable') || titleLower.includes('green')) return 'ü•¶';
                if (titleLower.includes('fruit') || titleLower.includes('apple')) return 'üçé';
                if (titleLower.includes('fish') || titleLower.includes('omega')) return 'üêü';
                if (titleLower.includes('bone') || titleLower.includes('calcium')) return 'ü¶¥';
                if (titleLower.includes('liver') || titleLower.includes('detox')) return 'ü´Ä';
                if (titleLower.includes('brain') || titleLower.includes('memory')) return 'üß†';
                if (titleLower.includes('heart') || titleLower.includes('cardio')) return '‚ù§Ô∏è';
                if (titleLower.includes('skin') || titleLower.includes('face')) return '‚ú®';
                if (titleLower.includes('sleep') || titleLower.includes('tired')) return 'üò¥';
                if (titleLower.includes('immune') || titleLower.includes('infection')) return 'üõ°Ô∏è';
                return 'üè•'; // Default health icon
            }

            format19SecondSummary(summary) {
                // Extract the most important point for a 19-second video
                const sentences = summary.split('.').filter(s => s.trim().length > 10);
                if (sentences.length === 0) return summary.substring(0, 120) + '...';
                
                // Take the first impactful sentence and make it punchy
                let mainPoint = sentences[0].trim();
                if (mainPoint.length > 100) {
                    mainPoint = mainPoint.substring(0, 97) + '...';
                }
                
                return `<strong>Quick Tip:</strong> ${mainPoint}.`;
            }
        }

        // Helper functions for global use
        function formatNumber(num) {
            if (num >= 1000000) {
                return (num / 1000000).toFixed(1) + 'M';
            }
            if (num >= 1000) {
                return (num / 1000).toFixed(1) + 'K';
            }
            return num.toString();
        }

        function formatDuration(duration) {
            // Convert ISO 8601 duration (PT15M30S) to readable format
            const match = duration.match(/PT(?:(\d+)H)?(?:(\d+)M)?(?:(\d+)S)?/);
            if (!match) return duration;
            
            const hours = parseInt(match[1]) || 0;
            const minutes = parseInt(match[2]) || 0;
            const seconds = parseInt(match[3]) || 0;
            
            if (hours > 0) {
                return `${hours}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            } else {
                return `${minutes}:${seconds.toString().padStart(2, '0')}`;
            }
        }

        // Video detail functions
        async function showVideoDetail(videoId) {
            const video = window.currentVideos?.find(v => v.video_id === videoId);
            if (!video) return;

            try {
                // Use mock detailed summary
                let detailedSummary = video.summary;

                document.getElementById('modalTitle').textContent = video.title;
                document.getElementById('modalMeta').innerHTML = `
                    <div class="stat-item">üìÖ ${new Date(video.published_at).toLocaleDateString()}</div>
                    <div class="stat-item">üëÅÔ∏è ${formatNumber(video.view_count)} views</div>
                    <div class="stat-item">‚è±Ô∏è ${formatDuration(video.duration)}</div>
                    <div class="stat-item">üîó ${video.stored_tokens} chunks stored</div>
                `;
                document.getElementById('modalSummary').innerHTML = detailedSummary.replace(/\n/g, '<br>');
                document.getElementById('modalWatchLink').href = `https://www.youtube.com/watch?v=${videoId}`;

                document.getElementById('videoModal').style.display = 'block';
                document.body.style.overflow = 'hidden';

            } catch (error) {
                console.error('Error showing video detail:', error);
            }
        }

        function closeVideoDetail() {
            if (window.speechSynthesis.speaking) {
                window.speechSynthesis.cancel();
            }
            document.getElementById('videoModal').style.display = 'none';
            document.body.style.overflow = 'auto';
        }

        function formatNumber(num) {
            if (!num) return '0';
            if (num >= 1000000) return (num / 1000000).toFixed(1) + 'M';
            if (num >= 1000) return (num / 1000).toFixed(1) + 'K';
            return num.toString();
        }

        function formatDuration(duration) {
            if (!duration) return 'Unknown';
            const match = duration.match(/PT(?:(\d+)H)?(?:(\d+)M)?(?:(\d+)S)?/);
            if (!match) return duration;
            
            const hours = parseInt(match[1]) || 0;
            const minutes = parseInt(match[2]) || 0;
            const seconds = parseInt(match[3]) || 0;
            
            if (hours > 0) {
                return `${hours}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            } else {
                return `${minutes}:${seconds.toString().padStart(2, '0')}`;
            }
        }

        // Enhanced voice reading with better quality
        function readText(elementId) {
            const element = document.getElementById(elementId);
            if (!element) return;

            const text = element.textContent || element.innerText;
            if (!text.trim()) return;

            if (window.speechSynthesis.speaking) {
                window.speechSynthesis.cancel();
            }

            const utterance = new SpeechSynthesisUtterance(text);
            
            // Voice settings for English only
            utterance.lang = 'en-US';
            utterance.rate = 0.8;
            utterance.pitch = 1.0;

            utterance.volume = 1;

            // Visual feedback
            const button = event.target;
            const originalText = button.innerHTML;
            button.innerHTML = '<span>‚è∏Ô∏è</span>Stop';
            button.disabled = true;

            utterance.onend = () => {
                button.innerHTML = originalText;
                button.disabled = false;
            };

            utterance.onerror = () => {
                button.innerHTML = originalText;
                button.disabled = false;
            };

            window.speechSynthesis.speak(utterance);
        }

        // Close modal when clicking outside
        window.onclick = function(event) {
            const modal = document.getElementById('videoModal');
            if (event.target === modal) {
                closeVideoDetail();
            }
        }

        // Tab switching functionality
        function switchTab(tabName) {
            // Update tab buttons
            document.querySelectorAll('.nav-tab').forEach(tab => tab.classList.remove('active'));
            event.target.classList.add('active');
            
            // Update page content
            document.querySelectorAll('.page-content').forEach(page => page.classList.remove('active'));
            document.getElementById(`${tabName}-page`).classList.add('active');
            
            // Load ingredients if switching to ingredients tab
            if (tabName === 'ingredients') {
                loadIngredients();
            }
        }

        // Current ingredient category
        let currentIngredientCategory = 'good';

        // Load ingredients by category
        async function loadIngredients(category = 'good') {
            const ingredientsGrid = document.getElementById('ingredientsGrid');
            currentIngredientCategory = category;
            
            ingredientsGrid.innerHTML = '<p style="text-align: center; color: var(--neutral-600);">Loading...</p>';
            
            try {
                const response = await fetch(`/api/ingredients?category=${category}`);
                const ingredients = await response.json();
                
                if (ingredients.length === 0) {
                    ingredientsGrid.innerHTML = '<p style="text-align: center; color: var(--neutral-600);">No items found in this category.</p>';
                    return;
                }
                
                ingredientsGrid.innerHTML = ingredients.map((ingredient, index) => `
                    <div class="video-card">
                        ${category === 'vitamins' ? `
                            <div class="video-thumbnail" style="background: linear-gradient(135deg, #fef9e7 0%, #fef3c7 100%); position: relative; display: flex; align-items: center; justify-content: center; border-radius: 12px 12px 0 0;">
                                <div style="text-align: center; padding: 20px;">
                                    <div style="font-size: 2.5rem; font-weight: 800; color: #92400e; margin-bottom: 8px; font-family: 'Playfair Display', serif;">${ingredient.name}</div>
                                    <div style="font-size: 1rem; color: #b45309; font-weight: 600;">SUPPLEMENT</div>
                                </div>
                            </div>
                        ` : `
                            <div class="video-thumbnail" style="background: linear-gradient(135deg, #f3f4f6 0%, #e5e7eb 100%); position: relative;">
                                <img id="food-img-${index}" 
                                     alt="${ingredient.name}" 
                                     style="width: 100%; height: 100%; object-fit: cover; border-radius: 12px 12px 0 0; display: none;"
                                     onload="this.nextElementSibling.style.display='none'; this.style.display='block';">
                                <div style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; display: flex; align-items: center; justify-content: center; font-size: 3rem; color: white; background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);">
                                    ${getCategoryIcon(category, ingredient)}
                                </div>
                            </div>
                        `}
                        <div class="video-content">
                            <h3 class="video-title" style="color: #1f2937 !important;">${ingredient.name}</h3>
                            <div class="video-date" style="color: #6b7280 !important;">
                                <span>üìä</span>
                                ${ingredient.type} ‚Ä¢ ${ingredient.videoCount} videos
                            </div>
                            <div class="video-summary" style="color: #374151 !important;">
                                <div class="video-summary-title" style="color: #f59e0b !important;">${category === 'bad' ? 'Why Dr. Berg Warns Against This' : 'What Dr. Berg Says'}</div>
                                <div style="color: #374151 !important;">${ingredient.naturalBenefits}</div>
                            </div>
                            ${ingredient.naturalRecommendation ? `
                                <div style="margin-top: 12px; padding: 12px; background: ${category === 'bad' ? '#fef2f2' : 'var(--accent-orange-light)'}; border-radius: 8px; border-left: 3px solid ${category === 'bad' ? '#dc2626' : 'var(--accent-orange)'};">
                                    <div style="font-weight: 600; color: ${category === 'bad' ? '#dc2626' : 'var(--accent-orange)'}; font-size: 0.9rem; margin-bottom: 4px;">DR. BERG'S ADVICE</div>
                                    <div style="font-size: 0.9rem; color: var(--neutral-700);">${ingredient.naturalRecommendation}</div>
                                </div>
                            ` : ''}
                            ${category === 'good' ? `
                                <div style="margin-top: 12px; text-align: center;">
                                    <button class="voice-btn" onclick="playElevenLabsVoice('${ingredient.name}', \`${ingredient.naturalBenefits}\`, this)" style="color: white !important;">
                                        <span>üîä</span>
                                        Listen with ElevenLabs
                                    </button>
                                </div>
                            ` : ''}
                        </div>
                    </div>
                `).join('');
                
                // Load images after HTML is rendered (skip vitamins - they use text styling)
                if (category !== 'vitamins') {
                    ingredients.forEach(async (ingredient, index) => {
                        try {
                            const response = await fetch(`/api/food-image?name=${encodeURIComponent(ingredient.name)}&category=${category}`);
                            if (response.ok) {
                                const data = await response.json();
                                const img = document.getElementById(`food-img-${index}`);
                                if (img && data.imageUrl) {
                                    img.src = data.imageUrl;
                                }
                            }
                        } catch (error) {
                            console.error(`Error loading image for ${ingredient.name}:`, error);
                        }
                    });
                }
                
            } catch (error) {
                console.error('Error loading ingredients:', error);
                ingredientsGrid.innerHTML = '<p style="color: var(--accent-orange);">Error loading content. Please try again.</p>';
            }
        }

        // Switch ingredient category
        function switchIngredientCategory(category) {
            // Update button states
            document.querySelectorAll('.category-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            // Load ingredients for this category
            loadIngredients(category);
        }

        // Extract ingredients from video summaries
        function extractIngredients(videos) {
            const ingredientMap = new Map();
            
            const commonIngredients = [
                'Vitamin D', 'Vitamin C', 'Vitamin B12', 'Vitamin K2', 'Magnesium', 
                'Zinc', 'Iron', 'Calcium', 'Omega-3', 'Probiotics', 'MCT Oil',
                'Apple Cider Vinegar', 'Turmeric', 'Ginger', 'Garlic', 'Spinach',
                'Broccoli', 'Avocado', 'Salmon', 'Eggs', 'Coconut Oil', 'Olive Oil'
            ];
            
            videos.forEach(video => {
                const summary = (video.summary || '').toLowerCase();
                
                commonIngredients.forEach(ingredient => {
                    if (summary.includes(ingredient.toLowerCase())) {
                        if (!ingredientMap.has(ingredient)) {
                            ingredientMap.set(ingredient, {
                                name: ingredient,
                                videos: [],
                                benefits: getIngredientBenefits(ingredient)
                            });
                        }
                        ingredientMap.get(ingredient).videos.push(video.video_id);
                    }
                });
            });
            
            return Array.from(ingredientMap.values())
                .filter(ingredient => ingredient.videos.length > 0)
                .sort((a, b) => b.videos.length - a.videos.length);
        }

        // Get ingredient benefits
        function getIngredientBenefits(ingredient) {
            const benefits = {
                'Vitamin D': 'Supports immune system, bone health, and mood regulation',
                'Vitamin C': 'Antioxidant protection, immune support, collagen synthesis',
                'Vitamin B12': 'Energy production, nervous system health, red blood cell formation',
                'Magnesium': 'Muscle function, heart health, stress reduction, sleep quality',
                'Zinc': 'Immune function, wound healing, protein synthesis',
                'Omega-3': 'Brain health, heart health, anti-inflammatory effects',
                'MCT Oil': 'Quick energy, mental clarity, ketosis support',
                'Apple Cider Vinegar': 'Blood sugar control, digestion, weight management',
                'Turmeric': 'Anti-inflammatory, antioxidant, joint health',
                'Avocado': 'Healthy fats, fiber, heart health, nutrient absorption'
            };
            
            return benefits[ingredient] || 'Multiple health benefits discussed in videos';
        }

        // Get ingredient icon
        function getIngredientIcon(ingredient) {
            const icons = {
                'Vitamin D': '‚òÄÔ∏è', 'Vitamin C': 'üçä', 'Vitamin B12': 'üîã',
                'Magnesium': '‚ö°', 'Zinc': 'üõ°Ô∏è', 'Omega-3': 'üêü',
                'MCT Oil': 'ü••', 'Apple Cider Vinegar': 'üçé', 'Turmeric': 'üü°',
                'Avocado': 'ü•ë', 'Broccoli': 'ü•¶', 'Spinach': 'ü•¨',
                'Salmon': 'üêü', 'Eggs': 'ü•ö', 'Garlic': 'üßÑ'
            };
            
            return icons[ingredient] || 'üíä';
        }

        // Get category-specific icon
        function getCategoryIcon(category, ingredient) {
            const name = ingredient.name.toLowerCase();
            
            if (category === 'good') {
                // Good food icons
                if (name.includes('butter')) return 'üßà';
                if (name.includes('green') || name.includes('spinach') || name.includes('kale')) return 'ü•¨';
                if (name.includes('avocado')) return 'ü•ë';
                if (name.includes('sardine') || name.includes('fish')) return 'üêü';
                if (name.includes('egg')) return 'ü•ö';
                return '‚úÖ'; // Default good icon
            }
            
            if (category === 'bad') {
                // Bad food icons
                if (name.includes('sugar')) return 'üç≠';
                if (name.includes('process')) return 'üì¶';
                if (name.includes('oil') || name.includes('vegetable')) return 'üõ¢Ô∏è';
                if (name.includes('grain') || name.includes('wheat')) return 'üåæ';
                if (name.includes('artificial') || name.includes('sweetener')) return 'üß™';
                return '‚ùå'; // Default bad icon
            }
            
            if (category === 'vitamins') {
                // Vitamin icons
                if (name.includes('vitamin d')) return '‚òÄÔ∏è';
                if (name.includes('vitamin k')) return 'ü¶¥';
                if (name.includes('vitamin b')) return 'üîã';
                if (name.includes('vitamin c')) return 'üçä';
                if (name.includes('magnesium')) return '‚ö°';
                if (name.includes('zinc')) return 'üõ°Ô∏è';
                return 'üíä'; // Default vitamin icon
            }
            
            return 'üè•'; // Default health icon
        }

        // Advanced ingredient icon based on category and name
        function getAdvancedIngredientIcon(ingredient) {
            return getCategoryIcon(ingredient.category, ingredient);
        }

        // ElevenLabs voice generation
        async function playElevenLabsVoice(name, text, buttonElement) {
            try {
                // Get button reference - either passed as parameter or from event
                const button = buttonElement || event.target;
                const originalText = button.innerHTML;
                
                console.log('üé§ Starting voice generation for:', name);
                console.log('üìù Text to convert:', text.substring(0, 100) + '...');
                
                button.innerHTML = '<span>üîÑ</span>Generating...';
                button.disabled = true;

                const response = await fetch('/api/voice', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ text: `${name}: ${text}` })
                });

                console.log('üì° Response status:', response.status);
                console.log('üìã Response headers:', response.headers);

                if (!response.ok) {
                    throw new Error(`Voice generation failed with status: ${response.status}`);
                }

                const audioBlob = await response.blob();
                console.log('üéµ Audio blob size:', audioBlob.size, 'bytes');
                console.log('üéµ Audio blob type:', audioBlob.type);
                
                const audioUrl = URL.createObjectURL(audioBlob);
                const audio = new Audio(audioUrl);
                
                console.log('üîä Created audio element, starting playback...');
                button.innerHTML = '<span>üîä</span>Playing...';
                
                audio.onended = () => {
                    console.log('‚úÖ Audio playback completed');
                    button.innerHTML = originalText;
                    button.disabled = false;
                    URL.revokeObjectURL(audioUrl);
                };
                
                audio.onerror = (e) => {
                    console.error('‚ùå Audio playback error:', e);
                    button.innerHTML = originalText;
                    button.disabled = false;
                    URL.revokeObjectURL(audioUrl);
                };
                
                // Add load event listener to ensure audio is ready
                audio.onloadeddata = () => {
                    console.log('üìä Audio data loaded, duration:', audio.duration);
                };
                
                await audio.play();
                console.log('üéµ Audio.play() called successfully');
                
            } catch (error) {
                console.error('‚ùå Error in playElevenLabsVoice:', error);
                const button = buttonElement || event.target;
                button.innerHTML = '<span>‚ùå</span>Error';
                setTimeout(() => {
                    button.innerHTML = '<span>üé§</span>Listen with ElevenLabs';
                    button.disabled = false;
                }, 2000);
            }
        }

        // Ingredient/Food Guide Functions
        function switchIngredientCategory(category) {
            // Update active button
            document.querySelectorAll('.category-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            // Load content for category
            loadIngredientContent(category);
        }

        function loadIngredientContent(category) {
            const grid = document.getElementById('ingredientsGrid');
            
            const content = {
                good: [
                    {
                        title: 'Leafy Greens',
                        icon: 'ü•¨',
                        description: 'Spinach, kale, arugula - packed with vitamins K, A, C and folate',
                        benefits: ['High in antioxidants', 'Supports liver detox', 'Rich in minerals']
                    },
                    {
                        title: 'Cruciferous Vegetables',
                        icon: 'ü•¶',
                        description: 'Broccoli, cauliflower, brussels sprouts - cancer-fighting compounds',
                        benefits: ['Supports thyroid health', 'Natural detoxification', 'Anti-inflammatory']
                    },
                    {
                        title: 'Avocados',
                        icon: 'ü•ë',
                        description: 'Healthy monounsaturated fats and potassium',
                        benefits: ['Heart healthy fats', 'High in potassium', 'Supports ketosis']
                    },
                    {
                        title: 'Wild-Caught Fish',
                        icon: 'üêü',
                        description: 'Salmon, sardines, mackerel - omega-3 fatty acids',
                        benefits: ['Anti-inflammatory', 'Brain health', 'Heart protection']
                    },
                    {
                        title: 'Grass-Fed Beef',
                        icon: 'ü•©',
                        description: 'High-quality protein with better omega-3 profile',
                        benefits: ['Complete protein', 'B-vitamins', 'Iron and zinc']
                    },
                    {
                        title: 'Nuts and Seeds',
                        icon: 'üå∞',
                        description: 'Almonds, walnuts, chia seeds - healthy fats and minerals',
                        benefits: ['Healthy fats', 'Magnesium', 'Vitamin E']
                    }
                ],
                bad: [
                    {
                        title: 'Refined Sugar',
                        icon: 'üç¨',
                        description: 'White sugar, high fructose corn syrup, artificial sweeteners',
                        problems: ['Spikes insulin', 'Feeds inflammation', 'Addictive properties']
                    },
                    {
                        title: 'Processed Grains',
                        icon: 'üçû',
                        description: 'White bread, pasta, cereals - stripped of nutrients',
                        problems: ['Blood sugar spikes', 'Nutrient deficient', 'Inflammatory']
                    },
                    {
                        title: 'Vegetable Oils',
                        icon: 'üõ¢Ô∏è',
                        description: 'Soybean, corn, canola oil - high in omega-6',
                        problems: ['Pro-inflammatory', 'Processed with chemicals', 'Unstable when heated']
                    },
                    {
                        title: 'Processed Meats',
                        icon: 'üå≠',
                        description: 'Hot dogs, deli meats, bacon with nitrates',
                        problems: ['Nitrates/nitrites', 'High sodium', 'Poor quality ingredients']
                    },
                    {
                        title: 'Trans Fats',
                        icon: 'üßà',
                        description: 'Margarine, shortening, fried foods',
                        problems: ['Increases inflammation', 'Damages cell membranes', 'Heart disease risk']
                    },
                    {
                        title: 'Artificial Additives',
                        icon: 'üß™',
                        description: 'MSG, artificial colors, preservatives',
                        problems: ['Neurological effects', 'Allergic reactions', 'Unknown long-term effects']
                    }
                ],
                vitamins: [
                    {
                        title: 'Vitamin D3',
                        icon: '‚òÄÔ∏è',
                        description: 'Essential for immune function and bone health',
                        dosage: '5,000-10,000 IU daily',
                        benefits: ['Immune support', 'Bone health', 'Mood regulation']
                    },
                    {
                        title: 'B-Complex',
                        icon: 'üíä',
                        description: 'Energy production and nervous system support',
                        dosage: 'High-quality B-complex daily',
                        benefits: ['Energy production', 'Nervous system', 'Red blood cell formation']
                    },
                    {
                        title: 'Magnesium',
                        icon: '‚ö°',
                        description: 'Involved in 300+ enzymatic reactions',
                        dosage: '400-600mg daily',
                        benefits: ['Muscle function', 'Heart health', 'Sleep quality']
                    },
                    {
                        title: 'Omega-3',
                        icon: 'üêü',
                        description: 'Anti-inflammatory essential fatty acids',
                        dosage: '1-2g EPA/DHA daily',
                        benefits: ['Brain health', 'Heart protection', 'Anti-inflammatory']
                    },
                    {
                        title: 'Vitamin K2',
                        icon: 'ü¶¥',
                        description: 'Directs calcium to bones, away from arteries',
                        dosage: '100-200mcg daily',
                        benefits: ['Bone health', 'Heart health', 'Works with D3']
                    },
                    {
                        title: 'Zinc',
                        icon: 'üõ°Ô∏è',
                        description: 'Immune function and wound healing',
                        dosage: '15-30mg daily',
                        benefits: ['Immune support', 'Wound healing', 'Taste and smell']
                    }
                ]
            };

            const items = content[category] || [];
            
            if (items.length === 0) {
                grid.innerHTML = '<p style="text-align: center; color: var(--neutral-600);">Content coming soon...</p>';
                return;
            }

            grid.innerHTML = items.map(item => `
                <div class="ingredient-card">
                    <div class="ingredient-icon">${item.icon}</div>
                    <h3 class="ingredient-title">${item.title}</h3>
                    <p class="ingredient-description">${item.description}</p>
                    ${item.dosage ? `<div class="ingredient-dosage"><strong>Suggested:</strong> ${item.dosage}</div>` : ''}
                    <div class="ingredient-benefits">
                        ${(item.benefits || item.problems || []).map(benefit => 
                            `<span class="benefit-tag ${item.problems ? 'problem' : 'benefit'}">${benefit}</span>`
                        ).join('')}
                    </div>
                </div>
            `).join('');
        }

        // Initialize demo content
        function initializeDemoContent() {
            // Pre-populate with demo videos for immediate showcase
            const demoVideos = [
                {
                    video_id: 'keto123',
                    title: 'The Complete Guide to Ketogenic Diet Success',
                    description: 'Learn the science-backed approach to ketosis and metabolic flexibility.',
                    published_at: '2024-06-15T10:00:00Z',
                    duration: 'PT15M30S',
                    view_count: 125000,
                    like_count: 8500,
                    summary: 'This comprehensive guide covers the fundamental principles of ketogenic nutrition, including macronutrient ratios, common mistakes, and practical implementation strategies for sustainable results.',
                    stored_tokens: 12
                },
                {
                    video_id: 'vitamin456',
                    title: 'Essential Vitamins You Need Daily',
                    description: 'Discover which vitamins are crucial for optimal health and how to get them.',
                    published_at: '2024-06-10T14:30:00Z',
                    duration: 'PT12M45S',
                    view_count: 89000,
                    like_count: 6200,
                    summary: 'An in-depth analysis of essential vitamins including D3, B-complex, magnesium, and omega-3 fatty acids. Covers deficiency symptoms, food sources, and supplementation guidelines.',
                    stored_tokens: 8
                },
                {
                    video_id: 'fasting789',
                    title: 'Intermittent Fasting: Science and Practice',
                    description: 'The complete guide to intermittent fasting protocols and their health benefits.',
                    published_at: '2024-06-05T09:15:00Z',
                    duration: 'PT18M20S',
                    view_count: 156000,
                    like_count: 11200,
                    summary: 'Explores various intermittent fasting protocols including 16:8, OMAD, and extended fasting. Discusses autophagy, insulin sensitivity, and practical implementation tips.',
                    stored_tokens: 15
                }
            ];

            // Set demo videos globally
            window.currentVideos = demoVideos;
            
            // Show sample Q&A immediately
            showSampleQA();
        }

        function showSampleQA() {
            const answerSection = document.getElementById('answerSection');
            const answerText = document.getElementById('answerText');
            const questionInput = document.getElementById('questionInput');
            
            // Set sample question
            questionInput.value = "What are the benefits of intermittent fasting?";
            
            // Show sample answer
            const sampleAnswer = `Intermittent fasting can offer numerous health benefits when done properly:<br><br>‚Ä¢ <strong>Improved insulin sensitivity</strong> - Helps your body use glucose more effectively<br>‚Ä¢ <strong>Autophagy activation</strong> - Cellular cleanup and repair processes<br>‚Ä¢ <strong>Weight management</strong> - Natural calorie restriction and metabolic benefits<br>‚Ä¢ <strong>Mental clarity</strong> - Many people report improved focus during fasting periods<br>‚Ä¢ <strong>Simplified eating schedule</strong> - Reduces decision fatigue around meals<br><br>Start with 16:8 (16 hours fasting, 8 hours eating) and listen to your body. Stay hydrated during fasting periods and break fasts with nutrient-dense foods.<br><br><em>üí° Try asking your own question above to see personalized responses!</em>`;
            
            answerText.innerHTML = sampleAnswer;
            answerSection.style.display = 'block';
        }

        // Tab switching functionality
        function switchTab(tabName) {
            // Remove active class from all tabs
            document.querySelectorAll('.nav-tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.page-content').forEach(page => page.style.display = 'none');
            
            // Add active class to clicked tab
            event.target.classList.add('active');
            
            // Show corresponding page
            const pageId = tabName === 'qa' ? 'qa-page' : 
                          tabName === 'videos' ? 'videos-page' : 
                          tabName === 'ingredients' ? 'ingredients-page' : 'qa-page';
            
            document.getElementById(pageId).style.display = 'block';
        }

        // Initialize the app
        document.addEventListener('DOMContentLoaded', () => {
            // Initialize demo content first
            initializeDemoContent();
            
            // Start the nutrition advisor
            const advisor = new NutritionAdvisor();
            
            // Load default ingredient content
            loadIngredientContent('good');
            
            // Load demo videos immediately 
            advisor.loadVideos();
            
            // Set initial page visibility
            document.getElementById('qa-page').style.display = 'block';
            document.getElementById('videos-page').style.display = 'none';
            document.getElementById('ingredients-page').style.display = 'none';
        });
    </script>
</body>
</html>